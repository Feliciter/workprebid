{"version":3,"sources":["webpack:///./modules/appnexusBidAdapter.js"],"names":["BIDDER_CODE","URL","VIDEO_TARGETING","USER_PARAMS","APP_DEVICE_PARAMS","DEBUG_PARAMS","NATIVE_MAPPING","body","body2","cta","image","serverName","requiredParams","required","minimumParams","sizes","icon","sponsoredBy","privacyLink","salePrice","displayUrl","SOURCE","spec","code","aliases","supportedMediaTypes","BANNER","VIDEO","NATIVE","isBidRequestValid","bid","params","placementId","member","invCode","buildRequests","bidRequests","bidderRequest","tags","map","bidToTag","userObjBid","find","hasUserInfo","userObj","Object","keys","user","filter","param","includes","forEach","appDeviceObjBid","hasAppDeviceInfo","appDeviceObj","app","appIdObjBid","hasAppId","appIdObj","id","appid","debugObj","debugObjParams","debugCookieName","debugCookie","utils","JSON","parse","e","debugBidRequest","hasDebug","debug","enabled","memberIdBid","hasMemberId","parseInt","payload","sdk","source","version","member_id","device","stringify","gdprConsent","gdpr_consent","consent_string","consentString","consent_required","gdprApplies","refererInfo","refererinfo","rd_ref","encodeURIComponent","referer","rd_top","reachedTop","rd_ifs","numIframes","rd_stk","stack","url","join","referrer_detection","payloadString","method","data","interpretResponse","serverResponse","bids","error","errorMessage","bidderCode","serverBid","rtbBid","getRtbBid","cpm","ad_type","newBid","mediaType","parseMediaType","push","debug_info","debugHeader","debugText","replace","getUserSyncs","syncOptions","iframeEnabled","type","transformBidParams","isOpenRtb","transformBidderParamKeywords","use_pmt_rule","usePaymentRule","isPopulatedArray","keywords","deleteValues","paramKey","convertedKey","arr","length","keyPairObj","value","newRenderer","adUnitCode","rendererOptions","renderer","Renderer","install","renderer_id","renderer_url","config","loaded","setRender","outstreamRender","err","setEventHandlers","impression","ended","document","querySelector","style","display","bidRequest","uuid","requestId","creativeId","creative_id","dealId","deal_id","currency","netRevenue","ttl","appnexus","buyerMemberId","buyer_member_id","dealPriority","deal_priority","dealCode","deal_code","rtb","video","width","player_width","height","player_height","vastUrl","asset_url","vastImpUrl","notify_url","adResponse","ad","ads","nativeAd","title","desc","desc2","ctatext","rating","sponsored","privacy_link","address","downloads","likes","phone","price","saleprice","clickUrl","link","displayurl","clickTrackers","click_trackers","impressionTrackers","impression_trackers","javascriptTrackers","javascript_trackers","main_img","banner","content","trackers","impression_urls","tracker","tag","transformSizes","primary_size","ad_types","bidId","allow_smaller_sizes","allowSmallerSizes","prebid","disable_psa","reserve","position","trafficSourceCode","traffic_source_code","privateSizes","private_sizes","supplyType","supply_type","pubClick","pubclick","extInvCode","ext_inv_code","externalImpId","external_imp_id","nativeParams","nativeRequest","buildNativeRequest","layouts","videoMediaType","context","require_asset_url","mediaTypes","requestSizes","sizeObj","i","size","request","key","requestKey","adunitKeys","requiredKeys","remaining","window","ANOutstreamVideo","renderAd","tagId","tag_id","getSize","split","targetId","getConfig","handleOutstreamRendererEvents","bind","eventName","handleVideoEvent","adType","registerBidder"],"mappings":"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","file":"appnexusBidAdapter.js","sourcesContent":["import { Renderer } from '../src/Renderer';\nimport * as utils from '../src/utils';\nimport { registerBidder } from '../src/adapters/bidderFactory';\nimport { BANNER, NATIVE, VIDEO } from '../src/mediaTypes';\nimport find from 'core-js/library/fn/array/find';\nimport includes from 'core-js/library/fn/array/includes';\n\nconst BIDDER_CODE = 'appnexus';\nconst URL = '//ib.adnxs.com/ut/v3/prebid';\nconst VIDEO_TARGETING = ['id', 'mimes', 'minduration', 'maxduration',\n  'startdelay', 'skippable', 'playback_method', 'frameworks'];\nconst USER_PARAMS = ['age', 'external_uid', 'segments', 'gender', 'dnt', 'language'];\nconst APP_DEVICE_PARAMS = ['geo', 'device_id']; // appid is collected separately\nconst DEBUG_PARAMS = ['enabled', 'dongle', 'member_id', 'debug_timeout'];\nconst NATIVE_MAPPING = {\n  body: 'description',\n  body2: 'desc2',\n  cta: 'ctatext',\n  image: {\n    serverName: 'main_image',\n    requiredParams: { required: true },\n    minimumParams: { sizes: [{}] },\n  },\n  icon: {\n    serverName: 'icon',\n    requiredParams: { required: true },\n    minimumParams: { sizes: [{}] },\n  },\n  sponsoredBy: 'sponsored_by',\n  privacyLink: 'privacy_link',\n  salePrice: 'saleprice',\n  displayUrl: 'displayurl'\n};\nconst SOURCE = 'pbjs';\n\nexport const spec = {\n  code: BIDDER_CODE,\n  aliases: ['appnexusAst', 'brealtime', 'emxdigital', 'pagescience', 'defymedia', 'gourmetads', 'matomy', 'featureforward', 'oftmedia', 'districtm'],\n  supportedMediaTypes: [BANNER, VIDEO, NATIVE],\n\n  /**\n   * Determines whether or not the given bid request is valid.\n   *\n   * @param {object} bid The bid to validate.\n   * @return boolean True if this is a valid bid, and false otherwise.\n   */\n  isBidRequestValid: function(bid) {\n    return !!(bid.params.placementId || (bid.params.member && bid.params.invCode));\n  },\n\n  /**\n   * Make a server request from the list of BidRequests.\n   *\n   * @param {BidRequest[]} bidRequests A non-empty list of bid requests which should be sent to the Server.\n   * @return ServerRequest Info describing the request to the server.\n   */\n  buildRequests: function(bidRequests, bidderRequest) {\n    const tags = bidRequests.map(bidToTag);\n    const userObjBid = find(bidRequests, hasUserInfo);\n    let userObj;\n    if (userObjBid) {\n      userObj = {};\n      Object.keys(userObjBid.params.user)\n        .filter(param => includes(USER_PARAMS, param))\n        .forEach(param => userObj[param] = userObjBid.params.user[param]);\n    }\n\n    const appDeviceObjBid = find(bidRequests, hasAppDeviceInfo);\n    let appDeviceObj;\n    if (appDeviceObjBid && appDeviceObjBid.params && appDeviceObjBid.params.app) {\n      appDeviceObj = {};\n      Object.keys(appDeviceObjBid.params.app)\n        .filter(param => includes(APP_DEVICE_PARAMS, param))\n        .forEach(param => appDeviceObj[param] = appDeviceObjBid.params.app[param]);\n    }\n\n    const appIdObjBid = find(bidRequests, hasAppId);\n    let appIdObj;\n    if (appIdObjBid && appIdObjBid.params && appDeviceObjBid.params.app && appDeviceObjBid.params.app.id) {\n      appIdObj = {\n        appid: appIdObjBid.params.app.id\n      };\n    }\n\n    let debugObj = {};\n    let debugObjParams = {};\n    const debugCookieName = 'apn_prebid_debug';\n    const debugCookie = utils.getCookie(debugCookieName) || null;\n\n    if (debugCookie) {\n      try {\n        debugObj = JSON.parse(debugCookie);\n      } catch (e) {\n        utils.logError('AppNexus Debug Auction Cookie Error:\\n\\n' + e);\n      }\n    } else {\n      const debugBidRequest = find(bidRequests, hasDebug);\n      if (debugBidRequest && debugBidRequest.debug) {\n        debugObj = debugBidRequest.debug;\n      }\n    }\n\n    if (debugObj && debugObj.enabled) {\n      Object.keys(debugObj)\n        .filter(param => includes(DEBUG_PARAMS, param))\n        .forEach(param => {\n          debugObjParams[param] = debugObj[param];\n        });\n    }\n\n    const memberIdBid = find(bidRequests, hasMemberId);\n    const member = memberIdBid ? parseInt(memberIdBid.params.member, 10) : 0;\n\n    const payload = {\n      tags: [...tags],\n      user: userObj,\n      sdk: {\n        source: SOURCE,\n        version: '$prebid.version$'\n      }\n    };\n    if (member > 0) {\n      payload.member_id = member;\n    }\n\n    if (appDeviceObjBid) {\n      payload.device = appDeviceObj\n    }\n    if (appIdObjBid) {\n      payload.app = appIdObj;\n    }\n\n    if (debugObjParams.enabled) {\n      payload.debug = debugObjParams;\n      utils.logInfo('AppNexus Debug Auction Settings:\\n\\n' + JSON.stringify(debugObjParams, null, 4));\n    }\n\n    if (bidderRequest && bidderRequest.gdprConsent) {\n      // note - objects for impbus use underscore instead of camelCase\n      payload.gdpr_consent = {\n        consent_string: bidderRequest.gdprConsent.consentString,\n        consent_required: bidderRequest.gdprConsent.gdprApplies\n      };\n    }\n\n    if (bidderRequest && bidderRequest.refererInfo) {\n      let refererinfo = {\n        rd_ref: encodeURIComponent(bidderRequest.refererInfo.referer),\n        rd_top: bidderRequest.refererInfo.reachedTop,\n        rd_ifs: bidderRequest.refererInfo.numIframes,\n        rd_stk: bidderRequest.refererInfo.stack.map((url) => encodeURIComponent(url)).join(',')\n      }\n      payload.referrer_detection = refererinfo;\n    }\n\n    const payloadString = JSON.stringify(payload);\n    return {\n      method: 'POST',\n      url: URL,\n      data: payloadString,\n      bidderRequest\n    };\n  },\n\n  /**\n   * Unpack the response from the server into a list of bids.\n   *\n   * @param {*} serverResponse A successful response from the server.\n   * @return {Bid[]} An array of bids which were nested inside the server.\n   */\n  interpretResponse: function(serverResponse, {bidderRequest}) {\n    serverResponse = serverResponse.body;\n    const bids = [];\n    if (!serverResponse || serverResponse.error) {\n      let errorMessage = `in response for ${bidderRequest.bidderCode} adapter`;\n      if (serverResponse && serverResponse.error) { errorMessage += `: ${serverResponse.error}`; }\n      utils.logError(errorMessage);\n      return bids;\n    }\n\n    if (serverResponse.tags) {\n      serverResponse.tags.forEach(serverBid => {\n        const rtbBid = getRtbBid(serverBid);\n        if (rtbBid) {\n          if (rtbBid.cpm !== 0 && includes(this.supportedMediaTypes, rtbBid.ad_type)) {\n            const bid = newBid(serverBid, rtbBid, bidderRequest);\n            bid.mediaType = parseMediaType(rtbBid);\n            bids.push(bid);\n          }\n        }\n      });\n    }\n\n    if (serverResponse.debug && serverResponse.debug.debug_info) {\n      let debugHeader = 'AppNexus Debug Auction for Prebid\\n\\n'\n      let debugText = debugHeader + serverResponse.debug.debug_info\n      debugText = debugText\n        .replace(/(<td>|<th>)/gm, '\\t') // Tables\n        .replace(/(<\\/td>|<\\/th>)/gm, '\\n') // Tables\n        .replace(/^<br>/gm, '') // Remove leading <br>\n        .replace(/(<br>\\n|<br>)/gm, '\\n') // <br>\n        .replace(/<h1>(.*)<\\/h1>/gm, '\\n\\n===== $1 =====\\n\\n') // Header H1\n        .replace(/<h[2-6]>(.*)<\\/h[2-6]>/gm, '\\n\\n*** $1 ***\\n\\n') // Headers\n        .replace(/(<([^>]+)>)/igm, ''); // Remove any other tags\n      utils.logMessage('https://console.appnexus.com/docs/understanding-the-debug-auction');\n      utils.logMessage(debugText);\n    }\n\n    return bids;\n  },\n\n  getUserSyncs: function(syncOptions) {\n    if (syncOptions.iframeEnabled) {\n      return [{\n        type: 'iframe',\n        url: '//acdn.adnxs.com/ib/static/usersync/v3/async_usersync.html'\n      }];\n    }\n  },\n\n  transformBidParams: function(params, isOpenRtb) {\n    params = utils.convertTypes({\n      'member': 'string',\n      'invCode': 'string',\n      'placementId': 'number',\n      'keywords': utils.transformBidderParamKeywords\n    }, params);\n\n    if (isOpenRtb) {\n      params.use_pmt_rule = (typeof params.usePaymentRule === 'boolean') ? params.usePaymentRule : false;\n      if (params.usePaymentRule) { delete params.usePaymentRule; }\n\n      if (isPopulatedArray(params.keywords)) {\n        params.keywords.forEach(deleteValues);\n      }\n\n      Object.keys(params).forEach(paramKey => {\n        let convertedKey = utils.convertCamelToUnderscore(paramKey);\n        if (convertedKey !== paramKey) {\n          params[convertedKey] = params[paramKey];\n          delete params[paramKey];\n        }\n      });\n    }\n\n    return params;\n  }\n}\n\nfunction isPopulatedArray(arr) {\n  return !!(utils.isArray(arr) && arr.length > 0);\n}\n\nfunction deleteValues(keyPairObj) {\n  if (isPopulatedArray(keyPairObj.value) && keyPairObj.value[0] === '') {\n    delete keyPairObj.value;\n  }\n}\n\nfunction newRenderer(adUnitCode, rtbBid, rendererOptions = {}) {\n  const renderer = Renderer.install({\n    id: rtbBid.renderer_id,\n    url: rtbBid.renderer_url,\n    config: rendererOptions,\n    loaded: false,\n    adUnitCode\n  });\n\n  try {\n    renderer.setRender(outstreamRender);\n  } catch (err) {\n    utils.logWarn('Prebid Error calling setRender on renderer', err);\n  }\n\n  renderer.setEventHandlers({\n    impression: () => utils.logMessage('AppNexus outstream video impression event'),\n    loaded: () => utils.logMessage('AppNexus outstream video loaded event'),\n    ended: () => {\n      utils.logMessage('AppNexus outstream renderer video event');\n      document.querySelector(`#${adUnitCode}`).style.display = 'none';\n    }\n  });\n  return renderer;\n}\n\n/**\n * Unpack the Server's Bid into a Prebid-compatible one.\n * @param serverBid\n * @param rtbBid\n * @param bidderRequest\n * @return Bid\n */\nfunction newBid(serverBid, rtbBid, bidderRequest) {\n  const bidRequest = utils.getBidRequest(serverBid.uuid, [bidderRequest]);\n  const bid = {\n    requestId: serverBid.uuid,\n    cpm: rtbBid.cpm,\n    creativeId: rtbBid.creative_id,\n    dealId: rtbBid.deal_id,\n    currency: 'USD',\n    netRevenue: true,\n    ttl: 300,\n    adUnitCode: bidRequest.adUnitCode,\n    appnexus: {\n      buyerMemberId: rtbBid.buyer_member_id,\n      dealPriority: rtbBid.deal_priority,\n      dealCode: rtbBid.deal_code\n    }\n  };\n\n  if (rtbBid.rtb.video) {\n    Object.assign(bid, {\n      width: rtbBid.rtb.video.player_width,\n      height: rtbBid.rtb.video.player_height,\n      vastUrl: rtbBid.rtb.video.asset_url,\n      vastImpUrl: rtbBid.notify_url,\n      ttl: 3600\n    });\n    // This supports Outstream Video\n    if (rtbBid.renderer_url) {\n      const rendererOptions = utils.deepAccess(\n        bidderRequest.bids[0],\n        'renderer.options'\n      );\n\n      Object.assign(bid, {\n        adResponse: serverBid,\n        renderer: newRenderer(bid.adUnitCode, rtbBid, rendererOptions)\n      });\n      bid.adResponse.ad = bid.adResponse.ads[0];\n      bid.adResponse.ad.video = bid.adResponse.ad.rtb.video;\n    }\n  } else if (rtbBid.rtb[NATIVE]) {\n    const nativeAd = rtbBid.rtb[NATIVE];\n    bid[NATIVE] = {\n      title: nativeAd.title,\n      body: nativeAd.desc,\n      body2: nativeAd.desc2,\n      cta: nativeAd.ctatext,\n      rating: nativeAd.rating,\n      sponsoredBy: nativeAd.sponsored,\n      privacyLink: nativeAd.privacy_link,\n      address: nativeAd.address,\n      downloads: nativeAd.downloads,\n      likes: nativeAd.likes,\n      phone: nativeAd.phone,\n      price: nativeAd.price,\n      salePrice: nativeAd.saleprice,\n      clickUrl: nativeAd.link.url,\n      displayUrl: nativeAd.displayurl,\n      clickTrackers: nativeAd.link.click_trackers,\n      impressionTrackers: nativeAd.impression_trackers,\n      javascriptTrackers: nativeAd.javascript_trackers\n    };\n    if (nativeAd.main_img) {\n      bid['native'].image = {\n        url: nativeAd.main_img.url,\n        height: nativeAd.main_img.height,\n        width: nativeAd.main_img.width,\n      };\n    }\n    if (nativeAd.icon) {\n      bid['native'].icon = {\n        url: nativeAd.icon.url,\n        height: nativeAd.icon.height,\n        width: nativeAd.icon.width,\n      };\n    }\n  } else {\n    Object.assign(bid, {\n      width: rtbBid.rtb.banner.width,\n      height: rtbBid.rtb.banner.height,\n      ad: rtbBid.rtb.banner.content\n    });\n    try {\n      const url = rtbBid.rtb.trackers[0].impression_urls[0];\n      const tracker = utils.createTrackPixelHtml(url);\n      bid.ad += tracker;\n    } catch (error) {\n      utils.logError('Error appending tracking pixel', error);\n    }\n  }\n\n  return bid;\n}\n\nfunction bidToTag(bid) {\n  const tag = {};\n  tag.sizes = transformSizes(bid.sizes);\n  tag.primary_size = tag.sizes[0];\n  tag.ad_types = [];\n  tag.uuid = bid.bidId;\n  if (bid.params.placementId) {\n    tag.id = parseInt(bid.params.placementId, 10);\n  } else {\n    tag.code = bid.params.invCode;\n  }\n  tag.allow_smaller_sizes = bid.params.allowSmallerSizes || false;\n  tag.use_pmt_rule = bid.params.usePaymentRule || false\n  tag.prebid = true;\n  tag.disable_psa = true;\n  if (bid.params.reserve) {\n    tag.reserve = bid.params.reserve;\n  }\n  if (bid.params.position) {\n    tag.position = {'above': 1, 'below': 2}[bid.params.position] || 0;\n  }\n  if (bid.params.trafficSourceCode) {\n    tag.traffic_source_code = bid.params.trafficSourceCode;\n  }\n  if (bid.params.privateSizes) {\n    tag.private_sizes = transformSizes(bid.params.privateSizes);\n  }\n  if (bid.params.supplyType) {\n    tag.supply_type = bid.params.supplyType;\n  }\n  if (bid.params.pubClick) {\n    tag.pubclick = bid.params.pubClick;\n  }\n  if (bid.params.extInvCode) {\n    tag.ext_inv_code = bid.params.extInvCode;\n  }\n  if (bid.params.externalImpId) {\n    tag.external_imp_id = bid.params.externalImpId;\n  }\n  if (!utils.isEmpty(bid.params.keywords)) {\n    let keywords = utils.transformBidderParamKeywords(bid.params.keywords);\n\n    if (keywords.length > 0) {\n      keywords.forEach(deleteValues);\n    }\n    tag.keywords = keywords;\n  }\n\n  if (bid.mediaType === NATIVE || utils.deepAccess(bid, `mediaTypes.${NATIVE}`)) {\n    tag.ad_types.push(NATIVE);\n\n    if (bid.nativeParams) {\n      const nativeRequest = buildNativeRequest(bid.nativeParams);\n      tag[NATIVE] = {layouts: [nativeRequest]};\n    }\n  }\n\n  const videoMediaType = utils.deepAccess(bid, `mediaTypes.${VIDEO}`);\n  const context = utils.deepAccess(bid, 'mediaTypes.video.context');\n\n  if (bid.mediaType === VIDEO || videoMediaType) {\n    tag.ad_types.push(VIDEO);\n  }\n\n  // instream gets vastUrl, outstream gets vastXml\n  if (bid.mediaType === VIDEO || (videoMediaType && context !== 'outstream')) {\n    tag.require_asset_url = true;\n  }\n\n  if (bid.params.video) {\n    tag.video = {};\n    // place any valid video params on the tag\n    Object.keys(bid.params.video)\n      .filter(param => includes(VIDEO_TARGETING, param))\n      .forEach(param => tag.video[param] = bid.params.video[param]);\n  }\n\n  if (\n    (utils.isEmpty(bid.mediaType) && utils.isEmpty(bid.mediaTypes)) ||\n    (bid.mediaType === BANNER || (bid.mediaTypes && bid.mediaTypes[BANNER]))\n  ) {\n    tag.ad_types.push(BANNER);\n  }\n\n  return tag;\n}\n\n/* Turn bid request sizes into ut-compatible format */\nfunction transformSizes(requestSizes) {\n  let sizes = [];\n  let sizeObj = {};\n\n  if (utils.isArray(requestSizes) && requestSizes.length === 2 &&\n    !utils.isArray(requestSizes[0])) {\n    sizeObj.width = parseInt(requestSizes[0], 10);\n    sizeObj.height = parseInt(requestSizes[1], 10);\n    sizes.push(sizeObj);\n  } else if (typeof requestSizes === 'object') {\n    for (let i = 0; i < requestSizes.length; i++) {\n      let size = requestSizes[i];\n      sizeObj = {};\n      sizeObj.width = parseInt(size[0], 10);\n      sizeObj.height = parseInt(size[1], 10);\n      sizes.push(sizeObj);\n    }\n  }\n\n  return sizes;\n}\n\nfunction hasUserInfo(bid) {\n  return !!bid.params.user;\n}\n\nfunction hasMemberId(bid) {\n  return !!parseInt(bid.params.member, 10);\n}\n\nfunction hasAppDeviceInfo(bid) {\n  if (bid.params) {\n    return !!bid.params.app\n  }\n}\n\nfunction hasAppId(bid) {\n  if (bid.params && bid.params.app) {\n    return !!bid.params.app.id\n  }\n  return !!bid.params.app\n}\n\nfunction hasDebug(bid) {\n  return !!bid.debug\n}\n\nfunction getRtbBid(tag) {\n  return tag && tag.ads && tag.ads.length && find(tag.ads, ad => ad.rtb);\n}\n\nfunction buildNativeRequest(params) {\n  const request = {};\n\n  // map standard prebid native asset identifier to /ut parameters\n  // e.g., tag specifies `body` but /ut only knows `description`.\n  // mapping may be in form {tag: '<server name>'} or\n  // {tag: {serverName: '<server name>', requiredParams: {...}}}\n  Object.keys(params).forEach(key => {\n    // check if one of the <server name> forms is used, otherwise\n    // a mapping wasn't specified so pass the key straight through\n    const requestKey =\n      (NATIVE_MAPPING[key] && NATIVE_MAPPING[key].serverName) ||\n      NATIVE_MAPPING[key] ||\n      key;\n\n    // required params are always passed on request\n    const requiredParams = NATIVE_MAPPING[key] && NATIVE_MAPPING[key].requiredParams;\n    request[requestKey] = Object.assign({}, requiredParams, params[key]);\n\n    // minimum params are passed if no non-required params given on adunit\n    const minimumParams = NATIVE_MAPPING[key] && NATIVE_MAPPING[key].minimumParams;\n\n    if (requiredParams && minimumParams) {\n      // subtract required keys from adunit keys\n      const adunitKeys = Object.keys(params[key]);\n      const requiredKeys = Object.keys(requiredParams);\n      const remaining = adunitKeys.filter(key => !includes(requiredKeys, key));\n\n      // if none are left over, the minimum params needs to be sent\n      if (remaining.length === 0) {\n        request[requestKey] = Object.assign({}, request[requestKey], minimumParams);\n      }\n    }\n  });\n\n  return request;\n}\n\nfunction outstreamRender(bid) {\n  // push to render queue because ANOutstreamVideo may not be loaded yet\n  bid.renderer.push(() => {\n    window.ANOutstreamVideo.renderAd({\n      tagId: bid.adResponse.tag_id,\n      sizes: [bid.getSize().split('x')],\n      targetId: bid.adUnitCode, // target div id to render video\n      uuid: bid.adResponse.uuid,\n      adResponse: bid.adResponse,\n      rendererOptions: bid.renderer.getConfig()\n    }, handleOutstreamRendererEvents.bind(null, bid));\n  });\n}\n\nfunction handleOutstreamRendererEvents(bid, id, eventName) {\n  bid.renderer.handleVideoEvent({ id, eventName });\n}\n\nfunction parseMediaType(rtbBid) {\n  const adType = rtbBid.ad_type;\n  if (adType === VIDEO) {\n    return VIDEO;\n  } else if (adType === NATIVE) {\n    return NATIVE;\n  } else {\n    return BANNER;\n  }\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/appnexusBidAdapter.js"],"sourceRoot":""}