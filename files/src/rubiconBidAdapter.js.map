{"version":3,"sources":["webpack:///./modules/rubiconBidAdapter.js"],"names":["INTEGRATION","isSecure","location","protocol","FASTLANE_ENDPOINT","VIDEO_ENDPOINT","SYNC_ENDPOINT","TIMEOUT_BUFFER","sizeMap","utils","item","key","spec","code","aliases","supportedMediaTypes","BANNER","VIDEO","isBidRequestValid","bid","params","test","accountId","bidType","buildRequests","bidRequests","bidderRequest","requests","videoRequests","filter","bidRequest","map","startTime","Date","getTime","size","parseSizes","data","page_url","_getPageUrl","resolution","_getScreenResolution","account_id","integration","transactionId","timeout","now","auctionStart","stash_creatives","slots","slotData","site_id","siteId","zone_id","zoneId","position","floor","parseFloat","element_id","adUnitCode","name","width","height","size_id","determineRubiconVideoSizeId","video","ae_pass_through_parameters","aeParams","language","forEach","Object","keys","fpdKey","value","Array","isArray","keywords","push","gdprConsent","gdprApplies","gdpr","Number","gdpr_consent","consentString","method","url","config","getConfig","concat","bidParams","createSlotParams","getOrderedParams","reduce","paramString","propValue","encodeURIComponent","Math","random","nonVideoRequests","groupedBidRequests","groupedBids","bidGroupKey","bidsInGroup","length","slice","combinedSlotParams","combineSlotUrlParams","containsTgV","containsTgI","orderedParams","indexOf","aSlotUrlParams","oCombinedSlotUrlParams","oCombinedParams","oSlotUrlParams","iIndex","param","hasOwnProperty","splice","re","RegExp","sValues","join","match","parsedSizes","latLong","latitude","longitude","undefined","userId","isNaN","toFixed","visitor","toString","inventory","digitrustParams","_getDigiTrustQueryParams","paramKey","interpretResponse","responseObj","body","ads","bids","ad","i","status","associatedBidRequest","requestId","bidId","currency","creativeId","creative_id","network","advertiser","cpm","dealId","deal","ttl","netRevenue","rubicon","advertiserId","networkId","creative_type","mediaType","playerWidth","playerHeight","vastUrl","creative_depot_url","impression_id","videoCacheKey","_renderCreative","script","split","num","rubiconTargeting","targeting","memo","values","sort","adA","adB","getUserSyncs","syncOptions","responses","hasSynced","iframeEnabled","type","transformBidParams","isOpenRtb","window","screen","getDigiTrustId","digiTrustUser","DigiTrust","getUser","member","success","identity","digiTrustId","privacy","optout","id","keyv","pageUrl","referrer","refererInfo","referer","secure","replace","impId","mediaTypes","playerSize","sizes","mapSizes","banner","masSizeOrdering","result","mappedSize","parseInt","hasVideoMediaType","log","MAS_SIZE_PRIORITY","first","second","firstPriority","secondPriority","rubiconSizeId","resetUserSync","registerBidder"],"mappings":"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","file":"rubiconBidAdapter.js","sourcesContent":["import * as utils from '../src/utils';\nimport {registerBidder} from '../src/adapters/bidderFactory';\nimport {config} from '../src/config';\nimport {BANNER, VIDEO} from '../src/mediaTypes';\n\nconst INTEGRATION = 'pbjs_lite_v$prebid.version$';\n\nfunction isSecure() {\n  return location.protocol === 'https:';\n}\n\n// use protocol relative urls for http or https\nexport const FASTLANE_ENDPOINT = '//fastlane.rubiconproject.com/a/api/fastlane.json';\nexport const VIDEO_ENDPOINT = '//fastlane-adv.rubiconproject.com/v1/auction/video';\nexport const SYNC_ENDPOINT = 'https://eus.rubiconproject.com/usync.html';\n\nconst TIMEOUT_BUFFER = 500;\n\nvar sizeMap = {\n  1: '468x60',\n  2: '728x90',\n  5: '120x90',\n  8: '120x600',\n  9: '160x600',\n  10: '300x600',\n  13: '200x200',\n  14: '250x250',\n  15: '300x250',\n  16: '336x280',\n  19: '300x100',\n  31: '980x120',\n  32: '250x360',\n  33: '180x500',\n  35: '980x150',\n  37: '468x400',\n  38: '930x180',\n  39: '750x100',\n  40: '750x200',\n  41: '750x300',\n  43: '320x50',\n  44: '300x50',\n  48: '300x300',\n  53: '1024x768',\n  54: '300x1050',\n  55: '970x90',\n  57: '970x250',\n  58: '1000x90',\n  59: '320x80',\n  60: '320x150',\n  61: '1000x1000',\n  64: '580x500',\n  65: '640x480',\n  66: '930x600',\n  67: '320x480',\n  68: '1800x1000',\n  72: '320x320',\n  73: '320x160',\n  78: '980x240',\n  79: '980x300',\n  80: '980x400',\n  83: '480x300',\n  94: '970x310',\n  96: '970x210',\n  101: '480x320',\n  102: '768x1024',\n  103: '480x280',\n  105: '250x800',\n  108: '320x240',\n  113: '1000x300',\n  117: '320x100',\n  125: '800x250',\n  126: '200x600',\n  144: '980x600',\n  145: '980x150',\n  159: '320x250',\n  179: '250x600',\n  195: '600x300',\n  198: '640x360',\n  199: '640x200',\n  213: '1030x590',\n  214: '980x360',\n  229: '320x180',\n  232: '580x400',\n  257: '400x600'\n};\nutils._each(sizeMap, (item, key) => sizeMap[item] = key);\n\nexport const spec = {\n  code: 'rubicon',\n  aliases: ['rubiconLite'],\n  supportedMediaTypes: [BANNER, VIDEO],\n  /**\n   * @param {object} bid\n   * @return boolean\n   */\n  isBidRequestValid: function (bid) {\n    if (typeof bid.params !== 'object') {\n      return false;\n    }\n    if (!/^\\d+$/.test(bid.params.accountId)) {\n      return false;\n    }\n    return !!bidType(bid, true);\n  },\n  /**\n   * @param {BidRequest[]} bidRequests\n   * @param bidderRequest\n   * @return ServerRequest[]\n   */\n  buildRequests: function (bidRequests, bidderRequest) {\n    // separate video bids because the requests are structured differently\n    let requests = [];\n    const videoRequests = bidRequests.filter(bidRequest => bidType(bidRequest) === 'video').map(bidRequest => {\n      bidRequest.startTime = new Date().getTime();\n\n      let params = bidRequest.params;\n      let size = parseSizes(bidRequest, 'video');\n\n      let data = {\n        page_url: _getPageUrl(bidRequest, bidderRequest),\n        resolution: _getScreenResolution(),\n        account_id: params.accountId,\n        integration: INTEGRATION,\n        'x_source.tid': bidRequest.transactionId,\n        timeout: bidderRequest.timeout - (Date.now() - bidderRequest.auctionStart + TIMEOUT_BUFFER),\n        stash_creatives: true,\n        slots: []\n      };\n\n      // Define the slot object\n      let slotData = {\n        site_id: params.siteId,\n        zone_id: params.zoneId,\n        position: params.position === 'atf' || params.position === 'btf' ? params.position : 'unknown',\n        floor: parseFloat(params.floor) > 0.01 ? params.floor : 0.01,\n        element_id: bidRequest.adUnitCode,\n        name: bidRequest.adUnitCode,\n        width: size[0],\n        height: size[1],\n        size_id: determineRubiconVideoSizeId(bidRequest)\n      };\n\n      if (params.video) {\n        data.ae_pass_through_parameters = params.video.aeParams;\n        slotData.language = params.video.language;\n      }\n\n      // Add visitor and inventory FPD values\n      // Frank expects the vales in each inventory and visitor fpd to be an array. so params.inventory.something === [] of some sort, otherwise it 400s\n      ['inventory', 'visitor'].forEach(function(key) {\n        if (params[key] && typeof params[key] === 'object') {\n          slotData[key] = {};\n          Object.keys(params[key]).forEach(function(fpdKey) {\n            let value = params[key][fpdKey];\n            if (Array.isArray(value)) {\n              slotData[key][fpdKey] = value;\n            } else if ((typeof value === 'string' && value !== '') || typeof value === 'number') {\n              slotData[key][fpdKey] = [value];\n            }\n          });\n        }\n      });\n\n      if (params.keywords && Array.isArray(params.keywords)) {\n        slotData.keywords = params.keywords;\n      }\n\n      data.slots.push(slotData);\n\n      if (bidderRequest.gdprConsent) {\n        // add 'gdpr' only if 'gdprApplies' is defined\n        if (typeof bidderRequest.gdprConsent.gdprApplies === 'boolean') {\n          data.gdpr = Number(bidderRequest.gdprConsent.gdprApplies);\n        }\n        data.gdpr_consent = bidderRequest.gdprConsent.consentString;\n      }\n\n      return {\n        method: 'POST',\n        url: VIDEO_ENDPOINT,\n        data,\n        bidRequest\n      }\n    });\n\n    if (config.getConfig('rubicon.singleRequest') !== true) {\n      // bids are not grouped if single request mode is not enabled\n      requests = videoRequests.concat(bidRequests.filter(bidRequest => bidType(bidRequest) === 'banner').map(bidRequest => {\n        const bidParams = spec.createSlotParams(bidRequest, bidderRequest);\n        return {\n          method: 'GET',\n          url: FASTLANE_ENDPOINT,\n          data: spec.getOrderedParams(bidParams).reduce((paramString, key) => {\n            const propValue = bidParams[key];\n            return ((utils.isStr(propValue) && propValue !== '') || utils.isNumber(propValue)) ? `${paramString}${key}=${encodeURIComponent(propValue)}&` : paramString;\n          }, '') + `slots=1&rand=${Math.random()}`,\n          bidRequest\n        };\n      }));\n    } else {\n      // single request requires bids to be grouped by site id into a single request\n      // note: utils.groupBy wasn't used because deep property access was needed\n      const nonVideoRequests = bidRequests.filter(bidRequest => bidType(bidRequest) === 'banner');\n      const groupedBidRequests = nonVideoRequests.reduce((groupedBids, bid) => {\n        (groupedBids[bid.params['siteId']] = groupedBids[bid.params['siteId']] || []).push(bid);\n        return groupedBids;\n      }, {});\n\n      requests = videoRequests.concat(Object.keys(groupedBidRequests).map(bidGroupKey => {\n        let bidsInGroup = groupedBidRequests[bidGroupKey];\n\n        // fastlane SRA has a limit of 10 slots\n        if (bidsInGroup.length > 10) {\n          utils.logWarn(`Rubicon bid adapter Warning: single request mode has a limit of 10 bids: ${bidsInGroup.length - 10} bids were not sent`);\n          bidsInGroup = bidsInGroup.slice(0, 10);\n        }\n\n        const combinedSlotParams = spec.combineSlotUrlParams(bidsInGroup.map(bidRequest => {\n          return spec.createSlotParams(bidRequest, bidderRequest);\n        }));\n\n        // SRA request returns grouped bidRequest arrays not a plain bidRequest\n        return {\n          method: 'GET',\n          url: FASTLANE_ENDPOINT,\n          data: spec.getOrderedParams(combinedSlotParams).reduce((paramString, key) => {\n            const propValue = combinedSlotParams[key];\n            return ((utils.isStr(propValue) && propValue !== '') || utils.isNumber(propValue)) ? `${paramString}${key}=${encodeURIComponent(propValue)}&` : paramString;\n          }, '') + `slots=${bidsInGroup.length}&rand=${Math.random()}`,\n          bidRequest: bidsInGroup,\n        };\n      }));\n    }\n    return requests;\n  },\n\n  getOrderedParams: function(params) {\n    const containsTgV = /^tg_v/\n    const containsTgI = /^tg_i/\n\n    const orderedParams = [\n      'account_id',\n      'site_id',\n      'zone_id',\n      'size_id',\n      'alt_size_ids',\n      'p_pos',\n      'gdpr',\n      'gdpr_consent',\n      'rf',\n      'dt.id',\n      'dt.keyv',\n      'dt.pref',\n      'p_geo.latitude',\n      'p_geo.longitude',\n      'kw'\n    ].concat(Object.keys(params).filter(item => containsTgV.test(item)))\n      .concat(Object.keys(params).filter(item => containsTgI.test(item)))\n      .concat([\n        'tk_flint',\n        'x_source.tid',\n        'p_screen_res',\n        'rp_floor',\n        'rp_secure',\n        'tk_user_key'\n      ]);\n\n    return orderedParams.concat(Object.keys(params).filter(item => (orderedParams.indexOf(item) === -1)));\n  },\n\n  /**\n   * @summary combines param values from an array of slots into a single semicolon delineated value\n   * or just one value if they are all the same.\n   * @param {Object[]} aSlotUrlParams - example [{p1: 'foo', p2: 'test'}, {p2: 'test'}, {p1: 'bar', p2: 'test'}]\n   * @return {Object} - example {p1: 'foo;;bar', p2: 'test'}\n   */\n  combineSlotUrlParams: function(aSlotUrlParams) {\n    // if only have params for one slot, return those params\n    if (aSlotUrlParams.length === 1) {\n      return aSlotUrlParams[0];\n    }\n\n    // reduce param values from all slot objects into an array of values in a single object\n    const oCombinedSlotUrlParams = aSlotUrlParams.reduce(function(oCombinedParams, oSlotUrlParams, iIndex) {\n      Object.keys(oSlotUrlParams).forEach(function(param) {\n        if (!oCombinedParams.hasOwnProperty(param)) {\n          oCombinedParams[param] = new Array(aSlotUrlParams.length); // initialize array;\n        }\n        // insert into the proper element of the array\n        oCombinedParams[param].splice(iIndex, 1, oSlotUrlParams[param]);\n      });\n\n      return oCombinedParams;\n    }, {});\n\n    // convert arrays into semicolon delimited strings\n    const re = new RegExp('^([^;]*)(;\\\\1)+$'); // regex to test for duplication\n\n    Object.keys(oCombinedSlotUrlParams).forEach(function(param) {\n      const sValues = oCombinedSlotUrlParams[param].join(';');\n      // consolidate param values into one value if they are all the same\n      const match = sValues.match(re);\n      oCombinedSlotUrlParams[param] = match ? match[1] : sValues;\n    });\n\n    return oCombinedSlotUrlParams;\n  },\n\n  /**\n   * @param {BidRequest} bidRequest\n   * @param {Object} bidderRequest\n   * @returns {Object} - object key values named and formatted as slot params\n   */\n  createSlotParams: function(bidRequest, bidderRequest) {\n    bidRequest.startTime = new Date().getTime();\n\n    const params = bidRequest.params;\n\n    // use rubicon sizes if provided, otherwise adUnit.sizes\n    const parsedSizes = parseSizes(bidRequest, 'banner');\n\n    const [latitude, longitude] = params.latLong || [];\n\n    const data = {\n      'account_id': params.accountId,\n      'site_id': params.siteId,\n      'zone_id': params.zoneId,\n      'size_id': parsedSizes[0],\n      'alt_size_ids': parsedSizes.slice(1).join(',') || undefined,\n      'p_pos': params.position === 'atf' || params.position === 'btf' ? params.position : 'unknown',\n      'rp_floor': (params.floor = parseFloat(params.floor)) > 0.01 ? params.floor : 0.01,\n      'rp_secure': isSecure() ? '1' : '0',\n      'tk_flint': INTEGRATION,\n      'x_source.tid': bidRequest.transactionId,\n      'p_screen_res': _getScreenResolution(),\n      'kw': Array.isArray(params.keywords) ? params.keywords.join(',') : '',\n      'tk_user_key': params.userId,\n      'p_geo.latitude': isNaN(parseFloat(latitude)) ? undefined : parseFloat(latitude).toFixed(4),\n      'p_geo.longitude': isNaN(parseFloat(longitude)) ? undefined : parseFloat(longitude).toFixed(4),\n      'tg_fl.eid': bidRequest.code,\n      'rf': _getPageUrl(bidRequest, bidderRequest)\n    };\n\n    if (bidderRequest.gdprConsent) {\n      // add 'gdpr' only if 'gdprApplies' is defined\n      if (typeof bidderRequest.gdprConsent.gdprApplies === 'boolean') {\n        data['gdpr'] = Number(bidderRequest.gdprConsent.gdprApplies);\n      }\n      data['gdpr_consent'] = bidderRequest.gdprConsent.consentString;\n    }\n\n    // visitor properties\n    if (params.visitor !== null && typeof params.visitor === 'object') {\n      Object.keys(params.visitor).forEach((key) => {\n        if (params.visitor[key] != null) {\n          data[`tg_v.${key}`] = params.visitor[key].toString(); // initialize array;\n        }\n      });\n    }\n\n    // inventory properties\n    if (params.inventory !== null && typeof params.inventory === 'object') {\n      Object.keys(params.inventory).forEach((key) => {\n        if (params.inventory[key] != null) {\n          data[`tg_i.${key}`] = params.inventory[key].toString();\n        }\n      });\n    }\n\n    // digitrust properties\n    const digitrustParams = _getDigiTrustQueryParams();\n    Object.keys(digitrustParams).forEach(paramKey => {\n      data[paramKey] = digitrustParams[paramKey];\n    });\n\n    return data;\n  },\n\n  /**\n   * @param {*} responseObj\n   * @param {BidRequest|Object.<string, BidRequest[]>} bidRequest - if request was SRA the bidRequest argument will be a keyed BidRequest array object,\n   * non-SRA responses return a plain BidRequest object\n   * @return {Bid[]} An array of bids which\n   */\n  interpretResponse: function (responseObj, {bidRequest}) {\n    responseObj = responseObj.body;\n\n    // check overall response\n    if (!responseObj || typeof responseObj !== 'object') {\n      return [];\n    }\n\n    let ads = responseObj.ads;\n\n    // video ads array is wrapped in an object\n    if (typeof bidRequest === 'object' && !Array.isArray(bidRequest) && bidType(bidRequest) === 'video' && typeof ads === 'object') {\n      ads = ads[bidRequest.adUnitCode];\n    }\n\n    // check the ad response\n    if (!Array.isArray(ads) || ads.length < 1) {\n      return [];\n    }\n\n    return ads.reduce((bids, ad, i) => {\n      if (ad.status !== 'ok') {\n        return bids;\n      }\n\n      // associate bidRequests; assuming ads matches bidRequest\n      const associatedBidRequest = Array.isArray(bidRequest) ? bidRequest[i] : bidRequest;\n\n      if (associatedBidRequest && typeof associatedBidRequest === 'object') {\n        let bid = {\n          requestId: associatedBidRequest.bidId,\n          currency: 'USD',\n          creativeId: ad.creative_id || `${ad.network || ''}-${ad.advertiser || ''}`,\n          cpm: ad.cpm || 0,\n          dealId: ad.deal,\n          ttl: 300, // 5 minutes\n          netRevenue: config.getConfig('rubicon.netRevenue') || false,\n          rubicon: {\n            advertiserId: ad.advertiser, networkId: ad.network\n          }\n        };\n\n        if (ad.creative_type) {\n          bid.mediaType = ad.creative_type;\n        }\n\n        if (ad.creative_type === VIDEO) {\n          bid.width = associatedBidRequest.params.video.playerWidth;\n          bid.height = associatedBidRequest.params.video.playerHeight;\n          bid.vastUrl = ad.creative_depot_url;\n          bid.impression_id = ad.impression_id;\n          bid.videoCacheKey = ad.impression_id;\n        } else {\n          bid.ad = _renderCreative(ad.script, ad.impression_id);\n          [bid.width, bid.height] = sizeMap[ad.size_id].split('x').map(num => Number(num));\n        }\n\n        // add server-side targeting\n        bid.rubiconTargeting = (Array.isArray(ad.targeting) ? ad.targeting : [])\n          .reduce((memo, item) => {\n            memo[item.key] = item.values[0];\n            return memo;\n          }, {'rpfl_elemid': associatedBidRequest.adUnitCode});\n\n        bids.push(bid);\n      } else {\n        utils.logError(`Rubicon bid adapter Error: bidRequest undefined at index position:${i}`, bidRequest, responseObj);\n      }\n\n      return bids;\n    }, []).sort((adA, adB) => {\n      return (adB.cpm || 0.0) - (adA.cpm || 0.0);\n    });\n  },\n  getUserSyncs: function (syncOptions, responses, gdprConsent) {\n    if (!hasSynced && syncOptions.iframeEnabled) {\n      // data is only assigned if params are available to pass to SYNC_ENDPOINT\n      let params = '';\n\n      if (gdprConsent && typeof gdprConsent.consentString === 'string') {\n        // add 'gdpr' only if 'gdprApplies' is defined\n        if (typeof gdprConsent.gdprApplies === 'boolean') {\n          params += `?gdpr=${Number(gdprConsent.gdprApplies)}&gdpr_consent=${gdprConsent.consentString}`;\n        } else {\n          params += `?gdpr_consent=${gdprConsent.consentString}`;\n        }\n      }\n\n      hasSynced = true;\n      return {\n        type: 'iframe',\n        url: SYNC_ENDPOINT + params\n      };\n    }\n  },\n  /**\n   * Covert bid param types for S2S\n   * @param {Object} params bid params\n   * @param {Boolean} isOpenRtb boolean to check openrtb2 protocol\n   * @return {Object} params bid params\n   */\n  transformBidParams: function(params, isOpenRtb) {\n    return utils.convertTypes({\n      'accountId': 'number',\n      'siteId': 'number',\n      'zoneId': 'number'\n    }, params);\n  }\n};\n\nfunction _getScreenResolution() {\n  return [window.screen.width, window.screen.height].join('x');\n}\n\nfunction _getDigiTrustQueryParams() {\n  function getDigiTrustId() {\n    let digiTrustUser = window.DigiTrust && (config.getConfig('digiTrustId') || window.DigiTrust.getUser({member: 'T9QSFKPDN9'}));\n    return (digiTrustUser && digiTrustUser.success && digiTrustUser.identity) || null;\n  }\n\n  let digiTrustId = getDigiTrustId();\n  // Verify there is an ID and this user has not opted out\n  if (!digiTrustId || (digiTrustId.privacy && digiTrustId.privacy.optout)) {\n    return [];\n  }\n  return {\n    'dt.id': digiTrustId.id,\n    'dt.keyv': digiTrustId.keyv,\n    'dt.pref': 0\n  };\n}\n\n/**\n * @param {BidRequest} bidRequest\n * @returns {string}\n */\nfunction _getPageUrl(bidRequest, bidderRequest) {\n  let pageUrl = config.getConfig('pageUrl');\n  if (bidRequest.params.referrer) {\n    pageUrl = bidRequest.params.referrer;\n  } else if (!pageUrl) {\n    pageUrl = bidderRequest.refererInfo.referer;\n  }\n  return bidRequest.params.secure ? pageUrl.replace(/^http:/i, 'https:') : pageUrl;\n}\n\nfunction _renderCreative(script, impId) {\n  return `<html>\n<head><script type='text/javascript'>inDapIF=true;</script></head>\n<body style='margin : 0; padding: 0;'>\n<!-- Rubicon Project Ad Tag -->\n<div data-rp-impression-id='${impId}'>\n<script type='text/javascript'>${script}</script>\n</div>\n</body>\n</html>`;\n}\n\nfunction parseSizes(bid, mediaType) {\n  let params = bid.params;\n  if (mediaType === 'video') {\n    let size = [];\n    if (params.video && params.video.playerWidth && params.video.playerHeight) {\n      size = [\n        params.video.playerWidth,\n        params.video.playerHeight\n      ];\n    } else if (Array.isArray(utils.deepAccess(bid, 'mediaTypes.video.playerSize')) && bid.mediaTypes.video.playerSize.length === 1) {\n      size = bid.mediaTypes.video.playerSize[0];\n    } else if (Array.isArray(bid.sizes) && bid.sizes.length > 0 && Array.isArray(bid.sizes[0]) && bid.sizes[0].length > 1) {\n      size = bid.sizes[0];\n    }\n    return size;\n  }\n\n  // deprecated: temp legacy support\n  let sizes = [];\n  if (Array.isArray(params.sizes)) {\n    sizes = params.sizes;\n  } else if (typeof utils.deepAccess(bid, 'mediaTypes.banner.sizes') !== 'undefined') {\n    sizes = mapSizes(bid.mediaTypes.banner.sizes);\n  } else if (Array.isArray(bid.sizes) && bid.sizes.length > 0) {\n    sizes = mapSizes(bid.sizes)\n  } else {\n    utils.logWarn('Warning: no sizes are setup or found');\n  }\n\n  return masSizeOrdering(sizes);\n}\n\nfunction mapSizes(sizes) {\n  return utils.parseSizesInput(sizes)\n  // map sizes while excluding non-matches\n    .reduce((result, size) => {\n      let mappedSize = parseInt(sizeMap[size], 10);\n      if (mappedSize) {\n        result.push(mappedSize);\n      }\n      return result;\n    }, []);\n}\n\n/**\n * Test if bid has mediaType or mediaTypes set for video.\n * Also makes sure the video object is present in the rubicon bidder params\n * @param {BidRequest} bidRequest\n * @returns {boolean}\n */\nexport function hasVideoMediaType(bidRequest) {\n  if (typeof utils.deepAccess(bidRequest, 'params.video') !== 'object') {\n    return false;\n  }\n  return (bidRequest.mediaType === VIDEO || typeof utils.deepAccess(bidRequest, `mediaTypes.${VIDEO}`) !== 'undefined');\n}\n\n/**\n * Determine bidRequest mediaType\n * @param bid the bid to test\n * @param log whether we should log errors/warnings for invalid bids\n * @returns {string|undefined} Returns 'video' or 'banner' if resolves to a type, or undefined otherwise (invalid).\n */\nfunction bidType(bid, log = false) {\n  // Is it considered video ad unit by rubicon\n  if (hasVideoMediaType(bid)) {\n    // legacy mediaType or the new mediaTypes\n    // this is the preffered \"new\" way to define mediaTypes\n    if (typeof utils.deepAccess(bid, `mediaTypes.${VIDEO}`) !== 'undefined') {\n      // We require either context as instream or outstream\n      if (['outstream', 'instream'].indexOf(utils.deepAccess(bid, `mediaTypes.${VIDEO}.context`)) === -1) {\n        if (log) {\n          utils.logError('Rubicon bid adapter requires mediaTypes.video.context to be one of outstream or instream');\n        }\n        return;\n      }\n    } else { // Otherwise its the legacy way where mediaType == 'video'\n      if (log) {\n        utils.logWarn('Rubicon video bid requested using legacy `adUnit.mediaType = `video``\\nThis is deprecated\\nPlease move towards the PBJS standard using mediaTypes object!');\n      }\n      if (isNaN(parseInt(utils.deepAccess(bid, 'params.video.size_id')))) {\n        if (log) {\n          utils.logError('Rubicon bid adapter needs params.video.size_id to be declared and an integer in order to process a legacy video request using mediaType == video');\n        }\n        return;\n      }\n    }\n    // we require playerWidth and playerHeight to come from one of params.playerWidth/playerHeight or mediaTypes.video.playerSize or adUnit.sizes\n    if (parseSizes(bid, 'video').length < 2) {\n      if (log) {\n        utils.logError('Rubicon bid adapter could not determine the playerSize of the video\\nplayerWidth and playerHeight are inferred from one of params.playerWidth/playerHeight or mediaTypes.video.playerSize or adUnit.sizes, in that order');\n      }\n      return;\n    }\n\n    if (log) {\n      utils.logMessage('Rubicon bid adapter making video request for adUnit', bid.adUnitCode);\n    }\n    return 'video';\n  } else {\n    // we require banner sizes to come from one of params.sizes or mediaTypes.banner.sizes or adUnit.sizes, in that order\n    // if we cannot determine them, we reject it!\n    if (parseSizes(bid, 'banner').length === 0) {\n      if (log) {\n        utils.logError('Rubicon bid adapter could not determine the sizes for a banner request\\nThey are inferred from one of params.sizes or mediaTypes.banner.sizes or adUnit.sizes, in that order');\n      }\n      return;\n    }\n\n    // everything looks good for banner so lets do it\n    if (log) {\n      utils.logMessage('Rubicon bid adapter making banner request for adUnit', bid.adUnitCode);\n    }\n    return 'banner';\n  }\n}\n\nexport function masSizeOrdering(sizes) {\n  const MAS_SIZE_PRIORITY = [15, 2, 9];\n\n  return sizes.sort((first, second) => {\n    // sort by MAS_SIZE_PRIORITY priority order\n    const firstPriority = MAS_SIZE_PRIORITY.indexOf(first);\n    const secondPriority = MAS_SIZE_PRIORITY.indexOf(second);\n\n    if (firstPriority > -1 || secondPriority > -1) {\n      if (firstPriority === -1) {\n        return 1;\n      }\n      if (secondPriority === -1) {\n        return -1;\n      }\n      return firstPriority - secondPriority;\n    }\n\n    // and finally ascending order\n    return first - second;\n  });\n}\n\nexport function determineRubiconVideoSizeId(bid) {\n  // If we have size_id in the bid then use it\n  let rubiconSizeId = parseInt(utils.deepAccess(bid, 'params.video.size_id'));\n  if (!isNaN(rubiconSizeId)) {\n    return rubiconSizeId;\n  }\n  // otherwise 203 for outstream and 201 for instream\n  // When this function is used we know it has to be one of outstream or instream\n  return utils.deepAccess(bid, `mediaTypes.${VIDEO}.context`) === 'outstream' ? 203 : 201;\n}\n\nvar hasSynced = false;\n\nexport function resetUserSync() {\n  hasSynced = false;\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/rubiconBidAdapter.js"],"sourceRoot":""}